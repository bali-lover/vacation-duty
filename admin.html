<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°©í•™ ì¤‘ ë³µë¬´ ê´€ë¦¬ - ë‹´ë‹¹ììš© ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .date-grid {
            display: grid;
            grid-template-columns: 138px repeat(51, 40px);
            gap: 2px;
            margin-bottom: 20px;
            min-width: max-content;
        }

        .date-header {
            display: contents;
        }

        .teacher-name {
            background: white;
            color: #333;
            padding: 8px;
            font-weight: bold;
            font-size: 12px;
            border-radius: 6px;
            text-align: left;
            position: sticky;
            left: 0;
            z-index: 10;
            min-width: 138px;
            max-width: 138px;
            border: 2px solid #ccc;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .teacher-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .teacher-checkboxes {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .checkbox-row {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            font-weight: normal;
            white-space: nowrap;
        }

        .checkbox-row input[type="checkbox"] {
            width: 12px;
            height: 12px;
        }

        .date-cell {
            background: white;
            border: 2px solid #ccc;
            padding: 4px;
            text-align: center;
            font-size: 10px;
            font-weight: bold;
            min-height: 50px;
            min-width: 40px;
            max-width: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-radius: 4px;
            color: #333;
        }

        .date-number {
            font-size: 11px;
            color: #374151;
            margin-bottom: 2px;
        }

        .date-day {
            font-size: 9px;
            color: #6b7280;
        }

        .weekend {
            background: #fef2f2;
            color: #dc2626;
        }

        .holiday {
            background: #fef2f2;
            color: #dc2626;
            font-weight: bold;
        }

        .duty-cell {
            min-height: 40px;
            min-width: 40px;
            max-width: 40px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: bold;
            border: 2px solid;
            color: #333;
        }

        .duty-41 {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }

        .duty-work {
            background: rgba(33, 150, 243, 0.3);
            border-color: #2196F3;
        }

        .duty-business {
            background: rgba(255, 152, 0, 0.3);
            border-color: #FF9800;
        }

        .duty-vacation {
            background: rgba(244, 67, 54, 0.3);
            border-color: #F44336;
        }

        .duty-overseas {
            background: rgba(156, 39, 176, 0.3);
            border-color: #9C27B0;
        }

        .duty-weekend-excluded {
            background: rgba(200, 200, 200, 0.2);
            border-color: #999;
            border-style: dashed;
            opacity: 0.7;
            color: #666;
        }

        /* í˜¼í•© ë³µë¬´ ìœ í˜• ìŠ¤íƒ€ì¼ */
        .duty-mixed {
            position: relative;
            overflow: hidden;
            background: white;
            border: 2px solid #ccc;
        }

        .duty-mixed:hover {
            transform: scale(1.05);
            z-index: 10;
        }

        .mixed-duty-label {
            font-size: 8px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            padding: 1px 2px;
            border-radius: 2px;
            line-height: 1.2;
        }

        /* íˆ´íŒ ìŠ¤íƒ€ì¼ */
        .duty-tooltip {
            position: absolute;
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            pointer-events: none;
            white-space: nowrap;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }

        .duty-tooltip::before {
            content: '';
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 6px solid #2d3748;
        }

        .tooltip-title {
            font-weight: bold;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            color: #60d1fa;
        }

        .tooltip-time-slot {
            margin: 4px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tooltip-time {
            color: #a0aec0;
            font-family: 'Courier New', monospace;
        }

        .tooltip-type {
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 11px;
        }

        /* ë¹—ê¸ˆ ë¬´ëŠ¬ ìŠ¤íƒ€ì¼ */
        .checked-by-admin {
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 3px,
                rgba(0, 0, 0, 0.3) 3px,
                rgba(0, 0, 0, 0.3) 6px
            ) !important;
        }

        .checked-by-research {
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 3px,
                rgba(0, 0, 0, 0.3) 3px,
                rgba(0, 0, 0, 0.3) 6px
            ) !important;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 8px;
        }

        .btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 3px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(37,99,235,0.3);
        }

        .firebase-status {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .firebase-connected {
            background: #d4edda;
            color: #155724;
        }

        .firebase-disconnected {
            background: #f8d7da;
            color: #721c24;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .scroll-container {
            overflow-x: auto;
            overflow-y: visible;
            width: 100%;
            padding-bottom: 10px;
        }

        .legend {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .department-section {
            margin-bottom: 30px;
        }

        .department-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
            font-weight: bold;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .department-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 0 0 10px 10px;
            border: 1px solid rgba(255,255,255,0.2);
            border-top: none;
        }

        .department-grid {
            display: grid;
            grid-template-columns: 138px repeat(51, 40px);
            gap: 2px;
            padding: 15px;
            min-width: max-content;
        }

        .no-teachers {
            padding: 20px;
            text-align: center;
            color: #6b7280;
            font-style: italic;
        }

        .department-row {
            background: #374151;
            color: white;
            padding: 8px;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            border-radius: 6px;
            grid-column: 1 / -1;
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                <h1 class="text-2xl font-bold">ğŸ« ë°©í•™ ì¤‘ ë³µë¬´ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h1>
                <div style="display: flex; align-items: center;">
                    <span class="text-sm text-gray-500" id="last-updated">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -</span>
                    <button class="btn ml-4" onclick="refreshData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                    <span id="firebase-status" class="firebase-status firebase-disconnected">Firebase ì—°ê²° ì¤‘...</span>
                    <button onclick="showFirebaseSettings()" style="padding: 8px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">âš™ï¸ Firebase ì„¤ì •</button>
                </div>
            </div>
        </div>


        <!-- ë‚ ì§œë³„ ë³µë¬´ í˜„í™© -->
        <div class="card">
            <div class="flex justify-between items-center mb-4 flex-wrap gap-4">
                <h2 class="text-xl font-bold">ğŸ“… ë‚ ì§œë³„ ë³µë¬´ í˜„í™©</h2>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color duty-41"></div>
                        <span>41ì¡°</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color duty-work"></div>
                        <span>ê·¼ë¬´</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color duty-business"></div>
                        <span>ì¶œì¥</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color duty-vacation"></div>
                        <span>ì—°ê°€</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color duty-overseas"></div>
                        <span>êµ­ì™¸</span>
                    </div>
                    <button onclick="deleteSelectedTeachers()" style="padding: 8px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; margin-left: 10px;">ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ</button>
                </div>
            </div>

            <div class="scroll-container">
                <div id="main-grid" class="date-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase ì„¤ì • ëª¨ë‹¬ -->
    <div id="firebaseModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center;">
        <div class="modal-content" style="background: white; padding: 30px; border-radius: 12px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <h2 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">ğŸ”§ Firebase ì„¤ì •</h2>
            <div id="savedSettingsInfo" style="display: none; background: #d4edda; color: #155724; padding: 12px; border-radius: 6px; margin-bottom: 1rem;">
                ì €ì¥ëœ ì„¤ì •ì´ ìˆìŠµë‹ˆë‹¤. í•„ìš”ì‹œ ìˆ˜ì •í•´ì£¼ì„¸ìš”.
            </div>
            <div style="margin-bottom: 1rem;">
                <label for="firebaseApiKey" style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px;">Firebase API Key:</label>
                <input type="password" id="firebaseApiKey" placeholder="Firebase API Key ì…ë ¥" style="width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 6px;">
            </div>
            <div style="margin-bottom: 1.5rem;">
                <label for="firebaseProjectId" style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px;">Firebase Project ID:</label>
                <input type="text" id="firebaseProjectId" placeholder="Project ID ì…ë ¥" style="width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 6px;">
            </div>
            <div style="display: flex; gap: 12px;">
                <button onclick="saveFirebaseSettings()" style="flex: 1; padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white;">ì„¤ì • ì €ì¥</button>
                <button onclick="closeFirebaseModal()" style="flex: 1; padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; background: #6c757d; color: white;">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script>
        class AdminDashboard {
            constructor() {
                this.firebaseEnabled = false;
                this.database = null;
                this.vacationStart = new Date(2026, 0, 9); // 2026ë…„ 1ì›” 9ì¼
                this.vacationEnd = new Date(2026, 1, 28);   // 2026ë…„ 2ì›” 28ì¼
                this.holidays = [
                    new Date(2026, 0, 1),  // ì‹ ì •
                    new Date(2026, 1, 16), // ì„¤ë‚  ì „ë‚ 
                    new Date(2026, 1, 17), // ì„¤ë‚ 
                    new Date(2026, 1, 18)  // ì„¤ë‚  ë‹¤ìŒë‚ 
                ];
                this.allSettings = {};
                this.teachers = new Map();
                this.departments = [
                    'êµë¬´ê¸°íšë¶€',
                    'ë¯¸ë˜êµìœ¡ì—°êµ¬ë¶€',
                    'ìƒí™œì•ˆì „ì¸ê¶Œë¶€',
                    'ì§„ë¡œìƒë‹´ë¶€',
                    'í•™ìƒìì¹˜ë¶€',
                    'ê³¼í•™ì •ë³´ë¶€',
                    'ì¸ë¬¸ë³µì§€ë¶€',
                    'êµìœ¡ê³¼ì •ë¶€',
                    'ë¬¸í™”ì˜ˆìˆ ì²´ìœ¡ë¶€',
                    '1í•™ë…„ë¶€',
                    '2í•™ë…„ë¶€',
                    '3í•™ë…„ë¶€'
                ];

                this.initFirebase();
            }

            initFirebase() {
                try {
                    // localStorageì—ì„œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
                    const apiKey = localStorage.getItem('firebase_apiKey');
                    const projectId = localStorage.getItem('firebase_projectId');

                    if (!apiKey || !projectId) {
                        console.warn('Firebase ì„¤ì • ì—†ìŒ - í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚¬ìš©');
                        this.firebaseEnabled = false;
                        this.updateFirebaseStatus(false);
                        this.loadTestData();
                        return;
                    }

                    const firebaseConfig = {
                        apiKey: apiKey,
                        authDomain: `${projectId}.firebaseapp.com`,
                        databaseURL: `https://${projectId}-default-rtdb.asia-southeast1.firebasedatabase.app`,
                        projectId: projectId,
                        storageBucket: `${projectId}.firebasestorage.app`,
                        messagingSenderId: "383693605457",
                        appId: "1:383693605457:web:b5c75a08b0fcef08188670"
                    };

                    if (!firebase.apps.length) {
                        firebase.initializeApp(firebaseConfig);
                    }
                    this.database = firebase.database();

                    // ì—°ê²° í…ŒìŠ¤íŠ¸
                    this.database.ref('.info/connected').on('value', (snapshot) => {
                        if (snapshot.val() === true) {
                            console.log('âœ… Firebase ì—°ê²° ì„±ê³µ');
                            this.firebaseEnabled = true;
                            this.updateFirebaseStatus(true);
                            this.loadFromFirebase();
                        } else {
                            console.log('âŒ Firebase ì—°ê²° ëŠì–´ì§');
                            this.firebaseEnabled = false;
                            this.updateFirebaseStatus(false);
                        }
                    });

                } catch (error) {
                    console.warn('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    this.firebaseEnabled = false;
                    this.updateFirebaseStatus(false);
                    this.loadTestData();
                }
            }

            loadFromFirebase() {
                if (!this.firebaseEnabled || !this.database) return;

                const vacationDutyRef = this.database.ref('vacation-duty');

                // ì‹¤ì‹œê°„ ë™ê¸°í™”
                vacationDutyRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        this.allSettings = data;
                        console.log('Firebase ë°ì´í„° ë¡œë“œ:', Object.keys(data).length, 'ëª…');
                        this.updateDisplay();
                    } else {
                        console.log('Firebase ë°ì´í„° ì—†ìŒ');
                        this.loadTestData();
                    }
                });
            }

            updateFirebaseStatus(connected) {
                const statusElement = document.getElementById('firebase-status');
                if (connected) {
                    statusElement.textContent = 'ğŸŸ¢ Firebase ì—°ê²°ë¨';
                    statusElement.className = 'firebase-status firebase-connected';
                } else {
                    statusElement.textContent = 'ğŸ”´ Firebase ì—°ê²° ì•ˆë¨';
                    statusElement.className = 'firebase-status firebase-disconnected';
                }
            }

            loadTestData() {
                // í…ŒìŠ¤íŠ¸ìš© ë°ì´í„° 5ëª…ì˜ ê°€ìƒ êµì‚¬
                this.allSettings = {
                    'ê¹€ì² ìˆ˜_êµë¬´ê¸°íšë¶€': {
                        name: 'ê¹€ì² ìˆ˜',
                        department: 'êµë¬´ê¸°íšë¶€',
                        dutySchedule: {
                            '2026-01-09': '41',
                            '2026-01-10': 'vacation',
                            '2026-01-11': 'work',        // í† ìš”ì¼
                            '2026-01-12': 'business',    // ì¼ìš”ì¼
                            '2026-01-13': 'vacation',
                            '2026-01-14': 'overseas',
                            '2026-01-15': 'mixed',       // í˜¼í•© ë³µë¬´
                            '2026-01-16': '41',
                            '2026-01-17': 'mixed',       // í˜¼í•© ë³µë¬´
                            '2026-01-18': 'work',        // í† ìš”ì¼
                            '2026-01-19': 'vacation',    // ì¼ìš”ì¼
                            '2026-01-20': 'business',
                            '2026-01-21': 'business'
                        },
                        detailSchedule: {
                            '2026-01-15': [
                                { start: '08:40', end: '12:00', type: '41' },
                                { start: '13:00', end: '16:40', type: 'business' }
                            ],
                            '2026-01-17': [
                                { start: '08:40', end: '10:00', type: 'vacation' },
                                { start: '10:00', end: '16:40', type: 'overseas' }
                            ]
                        }
                    },
                    'ì´ì˜í¬_ë¯¸ë˜êµìœ¡ì—°êµ¬ë¶€': {
                        name: 'ì´ì˜í¬',
                        department: 'ë¯¸ë˜êµìœ¡ì—°êµ¬ë¶€',
                        dutySchedule: {
                            '2026-01-09': 'business',
                            '2026-01-10': 'business',
                            '2026-01-11': 'overseas',    // í† ìš”ì¼
                            '2026-01-12': 'work',        // ì¼ìš”ì¼
                            '2026-01-13': '41',
                            '2026-01-14': '41',
                            '2026-01-15': 'work',
                            '2026-01-16': 'work',
                            '2026-01-18': 'business',    // í† ìš”ì¼
                            '2026-01-19': 'vacation',    // ì¼ìš”ì¼
                            '2026-01-20': 'vacation',
                            '2026-01-21': 'vacation'
                        }
                    },
                    'ë°•ë¯¼ìˆ˜_êµë¬´ê¸°íšë¶€': {
                        name: 'ë°•ë¯¼ìˆ˜',
                        department: 'êµë¬´ê¸°íšë¶€',
                        dutySchedule: {
                            '2026-01-09': '41',
                            '2026-01-10': '41',
                            '2026-01-11': 'vacation',    // í† ìš”ì¼
                            '2026-01-12': 'overseas',    // ì¼ìš”ì¼
                            '2026-01-13': 'work',
                            '2026-01-14': 'mixed',       // í˜¼í•© ë³µë¬´ (3ê°œ ìœ í˜•)
                            '2026-01-15': '41',
                            '2026-01-16': 'overseas',
                            '2026-01-18': 'overseas',    // í† ìš”ì¼
                            '2026-01-19': 'business',    // ì¼ìš”ì¼
                            '2026-01-20': 'overseas',
                            '2026-01-21': '41'
                        },
                        detailSchedule: {
                            '2026-01-14': [
                                { start: '08:40', end: '10:30', type: 'vacation' },
                                { start: '10:30', end: '14:00', type: '41' },
                                { start: '14:00', end: '16:40', type: 'work' }
                            ]
                        }
                    },
                    'ìµœì§€ìˆ˜_1í•™ë…„ë¶€': {
                        name: 'ìµœì§€ìˆ˜',
                        department: '1í•™ë…„ë¶€',
                        dutySchedule: {
                            '2026-01-09': 'overseas',
                            '2026-01-10': 'overseas',
                            '2026-01-11': '41',          // í† ìš”ì¼
                            '2026-01-12': 'vacation',    // ì¼ìš”ì¼
                            '2026-01-13': 'overseas',
                            '2026-01-14': '41',
                            '2026-01-15': '41',
                            '2026-01-16': 'business',
                            '2026-01-18': 'vacation',    // í† ìš”ì¼
                            '2026-01-19': 'work',        // ì¼ìš”ì¼
                            '2026-01-20': 'work',
                            '2026-01-21': 'vacation'
                        }
                    },
                    'ì •ë¯¸ê²½_2í•™ë…„ë¶€': {
                        name: 'ì •ë¯¸ê²½',
                        department: '2í•™ë…„ë¶€',
                        dutySchedule: {
                            '2026-01-09': 'work',
                            '2026-01-10': 'work',
                            '2026-01-11': 'business',    // í† ìš”ì¼
                            '2026-01-12': '41',          // ì¼ìš”ì¼
                            '2026-01-13': 'business',
                            '2026-01-14': 'business',
                            '2026-01-15': 'vacation',
                            '2026-01-16': 'vacation',
                            '2026-01-18': 'overseas',    // í† ìš”ì¼
                            '2026-01-19': 'overseas',    // ì¼ìš”ì¼
                            '2026-01-20': '41',
                            '2026-01-21': '41'
                        }
                    }
                };

                console.log('êµì‚¬ 5ëª… ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                this.generateMainGrid();
                this.updateDisplay();
            }

            generateMainGrid() {
                const grid = document.getElementById('main-grid');

                // ë‚ ì§œ í—¤ë” ìƒì„±
                let html = this.generateDateHeader();
                grid.innerHTML = html;
            }

            getSafeId(department) {
                return department.replace(/\s+/g, '_').replace(/[^a-zA-Z0-9_]/g, '');
            }

            generateDateHeader() {
                const dates = this.getVacationDates();
                let html = '<div class="teacher-name">êµì‚¬ëª…</div>';

                dates.forEach(date => {
                    const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                    const isHoliday = this.isHoliday(date);
                    const day = date.getDate();
                    const dayName = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][date.getDay()];

                    const cssClass = isHoliday ? 'holiday' : (isWeekend ? 'weekend' : '');

                    html += `
                        <div class="date-cell ${cssClass}">
                            <div class="date-number">${day}</div>
                            <div class="date-day">${dayName}</div>
                        </div>
                    `;
                });

                return html;
            }

            getVacationDates() {
                const dates = [];
                const current = new Date(this.vacationStart);

                while (current <= this.vacationEnd) {
                    dates.push(new Date(current));
                    current.setDate(current.getDate() + 1);
                }

                return dates;
            }

            isHoliday(date) {
                return this.holidays.some(holiday =>
                    holiday.toDateString() === date.toDateString()
                );
            }

            updateDisplay() {
                this.updateDateGrid();
                document.getElementById('last-updated').textContent =
                    `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${new Date().toLocaleString()}`;
            }

            updateDateGrid() {
                const grid = document.getElementById('main-grid');
                const dates = this.getVacationDates();

                console.log('ì—…ë°ì´íŠ¸ ì‹œì‘, êµì‚¬ ìˆ˜:', Object.keys(this.allSettings).length);
                console.log('ë‚ ì§œ ìˆ˜:', dates.length);

                // ë‚ ì§œ í—¤ë”ë¡œ ì‹œì‘
                let html = this.generateDateHeader();

                // ëª¨ë“  êµì‚¬ í‘œì‹œ (ë¶€ì„œ êµ¬ë¶„ ì—†ì´)
                Object.keys(this.allSettings).forEach((teacherKey, index) => {
                    const teacherData = this.allSettings[teacherKey];
                    console.log(`êµì‚¬ ${index + 1}: ${teacherData.name}`);
                    html += `
                        <div class="teacher-name">
                            <div class="teacher-info">
                                <div style="display: flex; align-items: center; gap: 4px; width: 100%;">
                                    <input type="checkbox" class="delete-checkbox" data-teacher-key="${teacherKey}" style="width: 14px; height: 14px; cursor: pointer;">
                                    <span style="flex: 1;">${teacherData.name}</span>
                                </div>
                                <div class="teacher-checkboxes">
                                    <div class="checkbox-row">
                                        <input type="checkbox" id="dept-${index}" onchange="handleAdminCheck(${index}, this.checked)">
                                        <label for="dept-${index}">êµë¬´</label>
                                    </div>
                                    <div class="checkbox-row">
                                        <input type="checkbox" id="research-${index}" onchange="handleResearchCheck(${index}, this.checked)">
                                        <label for="research-${index}">ì—°êµ¬</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                    dates.forEach((date, dateIndex) => {
                        const dateString = this.formatDateForStorage(date);
                        const schedule = teacherData.dutySchedule || {};
                        const detailSchedule = teacherData.detailSchedule || {};

                        const dutyType = schedule[dateString];
                        const detailInfo = detailSchedule[dateString];

                        const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                        const isHoliday = this.isHoliday(date);

                        const cellId = `cell-${index}-${dateIndex}`;

                        // ì„¸ë¶€ ì‹œê°„ ì •ë³´ê°€ ìˆëŠ” ê²½ìš° í˜¼í•© ë³µë¬´ ì²´í¬
                        if (detailInfo && detailInfo.length > 0) {
                            // ì£¼ë§ ì œì™¸ í”Œë˜ê·¸ í™•ì¸
                            const isWeekendExcluded = detailInfo.some(slot => slot.isWeekendExcluded);

                            if (isWeekendExcluded) {
                                // ì£¼ë§ ì œì™¸ í‘œì‹œ
                                html += `<div id="${cellId}" class="duty-cell duty-weekend-excluded" data-teacher="${index}" data-duty="weekend-excluded">ì œì™¸</div>`;
                            } else {
                                // ì‹œê°„ìˆœìœ¼ë¡œ ì •ë ¬
                                const orderedSlots = detailInfo.sort((a, b) => a.start.localeCompare(b.start));
                                const dutyTypes = [...new Set(orderedSlots.map(slot => slot.type))]; // ì¤‘ë³µ ì œê±°

                                if (dutyTypes.length === 1) {
                                    // ë‹¨ì¼ ë³µë¬´ ìœ í˜•
                                    const singleType = dutyTypes[0];
                                    const typeName = this.getDutyTypeName(singleType);
                                    html += `<div id="${cellId}" class="duty-cell duty-${singleType}" data-teacher="${index}" data-duty="${singleType}" data-detail='${JSON.stringify(orderedSlots)}'>${typeName}</div>`;
                                } else if (dutyTypes.length > 1) {
                                    // í˜¼í•© ë³µë¬´ ìœ í˜• - ì‹œê°„ ë¹„ìœ¨ ê¸°ë°˜ ë¶„í• 
                                    html += this.createMixedDutyCell(orderedSlots, cellId, index);
                                }
                            }
                        } else if (dutyType) {
                            // ê¸°ë³¸ ë³µë¬´ ìœ í˜•ì´ ìˆëŠ” ê²½ìš° (ì£¼ë§/ê³µíœ´ì¼ ê´€ê³„ì—†ì´ í‘œì‹œ)
                            const typeName = this.getDutyTypeName(dutyType);
                            html += `<div id="${cellId}" class="duty-cell duty-${dutyType}" data-teacher="${index}" data-duty="${dutyType}">${typeName}</div>`;
                        } else if (isHoliday || isWeekend) {
                            // ë³µë¬´ ë°ì´í„°ê°€ ì—†ëŠ” ì£¼ë§ì´ë‚˜ ê³µíœ´ì¼
                            const cssClass = isHoliday ? 'holiday' : 'weekend';
                            html += `<div id="${cellId}" class="date-cell ${cssClass}" data-teacher="${index}"></div>`;
                        } else {
                            // í‰ì¼ì¸ë° ë³µë¬´ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ 41ì¡°
                            html += `<div id="${cellId}" class="duty-cell duty-41" data-teacher="${index}" data-duty="41">41ì¡°</div>`;
                        }
                    });
                });

                console.log('HTML ê¸¸ì´:', html.length);
                grid.innerHTML = html;
                console.log('ê·¸ë¦¬ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');

                // íˆ´íŒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                this.addTooltipListeners();
            }

            // íˆ´íŒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            addTooltipListeners() {
                const cells = document.querySelectorAll('.duty-cell[data-detail]');

                cells.forEach(cell => {
                    cell.addEventListener('mouseenter', (e) => this.showTooltip(e));
                    cell.addEventListener('mouseleave', () => this.hideTooltip());
                });
            }

            // íˆ´íŒ í‘œì‹œ
            showTooltip(event) {
                const cell = event.currentTarget;
                const detailData = cell.getAttribute('data-detail');

                if (!detailData) return;

                try {
                    const slots = JSON.parse(detailData);

                    // ê¸°ì¡´ íˆ´íŒ ì œê±°
                    this.hideTooltip();

                    // íˆ´íŒ ìƒì„±
                    const tooltip = document.createElement('div');
                    tooltip.className = 'duty-tooltip';
                    tooltip.id = 'duty-tooltip';

                    let tooltipHTML = '<div class="tooltip-title">ğŸ“‹ ì„¸ë¶€ ì‹œê°„ ì •ë³´</div>';

                    slots.forEach(slot => {
                        const typeColor = this.getTypeColor(slot.type);
                        tooltipHTML += `
                            <div class="tooltip-time-slot">
                                <span class="tooltip-time">${slot.start} ~ ${slot.end}</span>
                                <span class="tooltip-type" style="background: ${typeColor};">
                                    ${this.getDutyTypeName(slot.type)}
                                </span>
                            </div>
                        `;
                    });

                    tooltip.innerHTML = tooltipHTML;
                    document.body.appendChild(tooltip);

                    // ìœ„ì¹˜ ê³„ì‚°
                    const rect = cell.getBoundingClientRect();
                    const tooltipRect = tooltip.getBoundingClientRect();

                    let left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
                    let top = rect.top - tooltipRect.height - 10;

                    // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì¡°ì •
                    if (left < 10) left = 10;
                    if (left + tooltipRect.width > window.innerWidth - 10) {
                        left = window.innerWidth - tooltipRect.width - 10;
                    }
                    if (top < 10) {
                        top = rect.bottom + 10; // ì•„ë˜ë¡œ í‘œì‹œ
                    }

                    tooltip.style.left = left + 'px';
                    tooltip.style.top = top + 'px';
                } catch (error) {
                    console.error('íˆ´íŒ í‘œì‹œ ì˜¤ë¥˜:', error);
                }
            }

            // íˆ´íŒ ìˆ¨ê¸°ê¸°
            hideTooltip() {
                const tooltip = document.getElementById('duty-tooltip');
                if (tooltip) {
                    tooltip.remove();
                }
            }

            // ë³µë¬´ ìœ í˜•ë³„ ìƒ‰ìƒ ë°˜í™˜
            getTypeColor(type) {
                const colors = {
                    '41': '#4CAF50',
                    'work': '#2196F3',
                    'business': '#FF9800',
                    'vacation': '#F44336',
                    'overseas': '#9C27B0'
                };
                return colors[type] || '#666';
            }

            groupTeachersByDepartment() {
                const grouped = {};

                // ëª¨ë“  ë¶€ì„œ ì´ˆê¸°í™”
                this.departments.forEach(dept => {
                    grouped[dept] = [];
                });

                // êµì‚¬ë³„ë¡œ ë¶€ì„œì— ë°°ì •
                Object.values(this.allSettings).forEach(teacherData => {
                    const department = teacherData.department;
                    if (department && grouped[department]) {
                        grouped[department].push(teacherData);
                    }
                });

                return grouped;
            }

            formatDateForStorage(date) {
                return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
            }

            getDutyTypeName(type) {
                const types = {
                    '41': '41ì¡°',
                    'work': 'ê·¼ë¬´',
                    'business': 'ì¶œì¥',
                    'vacation': 'ì—°ê°€',
                    'overseas': 'êµ­ì™¸',
                    'weekend-excluded': 'ì œì™¸'
                };
                return types[type] || '41ì¡°';
            }

            // í˜¼í•© ë³µë¬´ ì²˜ë¦¬ í•¨ìˆ˜ (ì‹œê°„ ë¹„ìœ¨ ê¸°ë°˜)
            createMixedDutyCell(orderedSlots, cellId, teacherIndex) {
                const dutyTypes = [...new Set(orderedSlots.map(slot => slot.type))];
                const typeNames = dutyTypes.map(type => this.getDutyTypeName(type)).join('+');

                const cell = document.createElement('div');
                cell.id = cellId;
                cell.className = 'duty-cell duty-mixed';
                cell.setAttribute('data-teacher', teacherIndex);
                cell.setAttribute('data-duty', 'mixed');
                cell.setAttribute('data-mixed-types', dutyTypes.join(','));
                cell.setAttribute('data-detail', JSON.stringify(orderedSlots));

                // ì‹œê°„ ë¹„ìœ¨ ê¸°ë°˜ ë¶„í•  ìŠ¤íƒ€ì¼ ì ìš©
                this.applyTimeBasedSplit(cell, orderedSlots);

                // í…ìŠ¤íŠ¸ ì¶”ê°€
                const label = document.createElement('div');
                label.className = 'mixed-duty-label';
                label.textContent = typeNames;
                this.applyTimeBasedSplitToText(label, orderedSlots);
                cell.appendChild(label);

                return cell.outerHTML;
            }

            // ì‹œê°„ ë¹„ìœ¨ ê¸°ë°˜ ë¶„í•  ìŠ¤íƒ€ì¼ ì ìš©
            applyTimeBasedSplit(element, orderedSlots) {
                const colorMap = {
                    '41': 'rgba(76, 175, 80, 0.3)',
                    'work': 'rgba(33, 150, 243, 0.3)',
                    'business': 'rgba(255, 152, 0, 0.3)',
                    'vacation': 'rgba(244, 67, 54, 0.3)',
                    'overseas': 'rgba(156, 39, 176, 0.3)'
                };

                const borderMap = {
                    '41': '#4CAF50',
                    'work': '#2196F3',
                    'business': '#FF9800',
                    'vacation': '#F44336',
                    'overseas': '#9C27B0'
                };

                const totalMinutes = orderedSlots.reduce((sum, slot) => {
                    const start = this.timeToMinutes(slot.start);
                    const end = this.timeToMinutes(slot.end);
                    return sum + (end - start);
                }, 0);

                let gradientParts = [];
                let borderParts = [];
                let currentPercent = 0;

                orderedSlots.forEach(slot => {
                    const start = this.timeToMinutes(slot.start);
                    const end = this.timeToMinutes(slot.end);
                    const duration = end - start;
                    const percent = (duration / totalMinutes) * 100;

                    const color = colorMap[slot.type] || 'rgba(200, 200, 200, 0.3)';
                    const border = borderMap[slot.type] || '#ccc';

                    const startPercent = currentPercent;
                    const endPercent = currentPercent + percent;

                    gradientParts.push(`${color} ${startPercent}%`);
                    gradientParts.push(`${color} ${endPercent}%`);

                    borderParts.push(`${border} ${startPercent}%`);
                    borderParts.push(`${border} ${endPercent}%`);

                    currentPercent = endPercent;
                });

                element.style.background = `linear-gradient(to right, ${gradientParts.join(', ')})`;
                element.style.border = `2px solid`;
                element.style.borderImage = `linear-gradient(to right, ${borderParts.join(', ')}) 1`;
            }

            // í…ìŠ¤íŠ¸ì— ì‹œê°„ ë¹„ìœ¨ ê¸°ë°˜ ë¶„í•  ì ìš©
            applyTimeBasedSplitToText(textElement, orderedSlots) {
                const colorMap = {
                    '41': 'rgba(76, 175, 80, 0.9)',
                    'work': 'rgba(33, 150, 243, 0.9)',
                    'business': 'rgba(255, 152, 0, 0.9)',
                    'vacation': 'rgba(244, 67, 54, 0.9)',
                    'overseas': 'rgba(156, 39, 176, 0.9)'
                };

                const totalMinutes = orderedSlots.reduce((sum, slot) => {
                    const start = this.timeToMinutes(slot.start);
                    const end = this.timeToMinutes(slot.end);
                    return sum + (end - start);
                }, 0);

                let gradientParts = [];
                let currentPercent = 0;

                orderedSlots.forEach(slot => {
                    const start = this.timeToMinutes(slot.start);
                    const end = this.timeToMinutes(slot.end);
                    const duration = end - start;
                    const percent = (duration / totalMinutes) * 100;

                    const color = colorMap[slot.type] || 'rgba(100, 100, 100, 0.9)';

                    const startPercent = currentPercent;
                    const endPercent = currentPercent + percent;

                    gradientParts.push(`${color} ${startPercent}%`);
                    gradientParts.push(`${color} ${endPercent}%`);

                    currentPercent = endPercent;
                });

                textElement.style.background = `linear-gradient(to right, ${gradientParts.join(', ')})`;
                textElement.style.color = 'white';
                textElement.style.textShadow = '1px 1px 2px rgba(0,0,0,0.8)';
            }

            // ì‹œê°„ ë¬¸ìì—´ì„ ë¶„ ë‹¨ìœ„ë¡œ ë³€í™˜
            timeToMinutes(timeStr) {
                const [hours, minutes] = timeStr.split(':').map(Number);
                return hours * 60 + minutes;
            }

            // ëŒ€ê°ì„  ë¶„í•  ìŠ¤íƒ€ì¼ ì ìš© (index.htmlì—ì„œ ê°€ì ¸ì˜¨ ë¡œì§)
            applyDiagonalSplit(element, dutyTypes) {
                const colorMap = {
                    '41': 'rgba(76, 175, 80, 0.3)',
                    'work': 'rgba(33, 150, 243, 0.3)',
                    'business': 'rgba(255, 152, 0, 0.3)',
                    'vacation': 'rgba(244, 67, 54, 0.3)',
                    'overseas': 'rgba(156, 39, 176, 0.3)'
                };

                const borderMap = {
                    '41': '#4CAF50',
                    'work': '#2196F3',
                    'business': '#FF9800',
                    'vacation': '#F44336',
                    'overseas': '#9C27B0'
                };

                if (dutyTypes.length === 2) {
                    // 2ê°œ ìœ í˜• - ëŒ€ê°ì„  ë¶„í• 
                    const color1 = colorMap[dutyTypes[0]] || 'rgba(200, 200, 200, 0.3)';
                    const color2 = colorMap[dutyTypes[1]] || 'rgba(200, 200, 200, 0.3)';
                    const border1 = borderMap[dutyTypes[0]] || '#ccc';
                    const border2 = borderMap[dutyTypes[1]] || '#ccc';

                    element.style.background = `linear-gradient(45deg, ${color1} 50%, ${color2} 50%)`;
                    element.style.border = `3px solid`;
                    element.style.borderImage = `linear-gradient(45deg, ${border1} 50%, ${border2} 50%) 1`;
                } else if (dutyTypes.length === 3) {
                    // 3ê°œ ìœ í˜• - ì‚¼ë“±ë¶„
                    const color1 = colorMap[dutyTypes[0]] || 'rgba(200, 200, 200, 0.3)';
                    const color2 = colorMap[dutyTypes[1]] || 'rgba(200, 200, 200, 0.3)';
                    const color3 = colorMap[dutyTypes[2]] || 'rgba(200, 200, 200, 0.3)';
                    const border1 = borderMap[dutyTypes[0]] || '#ccc';
                    const border2 = borderMap[dutyTypes[1]] || '#ccc';
                    const border3 = borderMap[dutyTypes[2]] || '#ccc';

                    element.style.background = `linear-gradient(45deg, ${color1} 33%, ${color2} 33%, ${color2} 66%, ${color3} 66%)`;
                    element.style.border = `3px solid`;
                    element.style.borderImage = `linear-gradient(45deg, ${border1} 33%, ${border2} 33%, ${border2} 66%, ${border3} 66%) 1`;
                } else {
                    // 4ê°œ ì´ìƒ - ì²´í¬ë¬´ëŠ¬ íŒ¨í„´
                    const color1 = colorMap[dutyTypes[0]] || 'rgba(200, 200, 200, 0.3)';
                    const color2 = colorMap[dutyTypes[1]] || 'rgba(200, 200, 200, 0.3)';
                    const border1 = borderMap[dutyTypes[0]] || '#ccc';
                    const border2 = borderMap[dutyTypes[1]] || '#ccc';

                    element.style.background = `
                        repeating-linear-gradient(
                            45deg,
                            ${color1},
                            ${color1} 10px,
                            ${color2} 10px,
                            ${color2} 20px
                        )
                    `;
                    element.style.border = `3px solid`;
                    element.style.borderImage = `repeating-linear-gradient(45deg, ${border1}, ${border1} 5px, ${border2} 5px, ${border2} 10px) 1`;
                }
            }

            // í…ìŠ¤íŠ¸ì— ëŒ€ê°ì„  ë¶„í•  ìŠ¤íƒ€ì¼ ì ìš©
            applyDiagonalSplitToText(textElement, dutyTypes) {
                const colorMap = {
                    '41': 'rgba(76, 175, 80, 0.9)',
                    'work': 'rgba(33, 150, 243, 0.9)',
                    'business': 'rgba(255, 152, 0, 0.9)',
                    'vacation': 'rgba(244, 67, 54, 0.9)',
                    'overseas': 'rgba(156, 39, 176, 0.9)'
                };

                if (dutyTypes.length === 2) {
                    const color1 = colorMap[dutyTypes[0]] || 'rgba(100, 100, 100, 0.9)';
                    const color2 = colorMap[dutyTypes[1]] || 'rgba(100, 100, 100, 0.9)';

                    textElement.style.background = `linear-gradient(45deg, ${color1} 50%, ${color2} 50%)`;
                    textElement.style.color = 'white';
                    textElement.style.textShadow = '1px 1px 2px rgba(0,0,0,0.8)';
                } else if (dutyTypes.length === 3) {
                    const color1 = colorMap[dutyTypes[0]] || 'rgba(100, 100, 100, 0.9)';
                    const color2 = colorMap[dutyTypes[1]] || 'rgba(100, 100, 100, 0.9)';
                    const color3 = colorMap[dutyTypes[2]] || 'rgba(100, 100, 100, 0.9)';

                    textElement.style.background = `linear-gradient(45deg, ${color1} 33%, ${color2} 33%, ${color2} 66%, ${color3} 66%)`;
                    textElement.style.color = 'white';
                    textElement.style.textShadow = '1px 1px 2px rgba(0,0,0,0.8)';
                } else {
                    const color1 = colorMap[dutyTypes[0]] || 'rgba(100, 100, 100, 0.9)';
                    const color2 = colorMap[dutyTypes[1]] || 'rgba(100, 100, 100, 0.9)';

                    textElement.style.background = `
                        repeating-linear-gradient(
                            45deg,
                            ${color1},
                            ${color1} 5px,
                            ${color2} 5px,
                            ${color2} 10px
                        )
                    `;
                    textElement.style.color = 'white';
                    textElement.style.textShadow = '1px 1px 2px rgba(0,0,0,0.8)';
                }
            }
        }

        // ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
        let adminDashboard;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            adminDashboard = new AdminDashboard();
        });

        // ì „ì—­ í•¨ìˆ˜ë“¤
        function refreshData() {
            adminDashboard.updateDisplay();
        }

        // êµë¬´ë¶€ì¥ ì²´í¬ë°•ìŠ¤ í•¸ë“¤ëŸ¬ (ì—°ê°€, ì¶œì¥ ë¹—ê¸ˆ ì²˜ë¦¬)
        function handleAdminCheck(teacherIndex, isChecked) {
            const cells = document.querySelectorAll(`[data-teacher="${teacherIndex}"]`);

            cells.forEach(cell => {
                const dutyType = cell.getAttribute('data-duty');
                const mixedTypes = cell.getAttribute('data-mixed-types');

                // ë‹¨ì¼ ë³µë¬´ ìœ í˜• ì²˜ë¦¬
                if (dutyType === 'vacation' || dutyType === 'business') {
                    if (isChecked) {
                        cell.classList.add('checked-by-admin');
                    } else {
                        cell.classList.remove('checked-by-admin');
                    }
                }

                // í˜¼í•© ë³µë¬´ ìœ í˜• ì²˜ë¦¬
                if (dutyType === 'mixed' && mixedTypes) {
                    const typesArray = mixedTypes.split(',');
                    const hasAdminTypes = typesArray.some(type => type === 'vacation' || type === 'business');

                    if (hasAdminTypes) {
                        if (isChecked) {
                            cell.classList.add('checked-by-admin');
                        } else {
                            cell.classList.remove('checked-by-admin');
                        }
                    }
                }
            });
        }

        // ì—°êµ¬ë¶€ì¥ ì²´í¬ë°•ìŠ¤ í•¸ë“¤ëŸ¬ (41ì¡°, êµ­ì™¸ì—°ìˆ˜ ë¹—ê¸ˆ ì²˜ë¦¬)
        function handleResearchCheck(teacherIndex, isChecked) {
            const cells = document.querySelectorAll(`[data-teacher="${teacherIndex}"]`);

            cells.forEach(cell => {
                const dutyType = cell.getAttribute('data-duty');
                const mixedTypes = cell.getAttribute('data-mixed-types');

                // ë‹¨ì¼ ë³µë¬´ ìœ í˜• ì²˜ë¦¬
                if (dutyType === '41' || dutyType === 'overseas') {
                    if (isChecked) {
                        cell.classList.add('checked-by-research');
                    } else {
                        cell.classList.remove('checked-by-research');
                    }
                }

                // í˜¼í•© ë³µë¬´ ìœ í˜• ì²˜ë¦¬
                if (dutyType === 'mixed' && mixedTypes) {
                    const typesArray = mixedTypes.split(',');
                    const hasResearchTypes = typesArray.some(type => type === '41' || type === 'overseas');

                    if (hasResearchTypes) {
                        if (isChecked) {
                            cell.classList.add('checked-by-research');
                        } else {
                            cell.classList.remove('checked-by-research');
                        }
                    }
                }
            });
        }

        // Firebase ì„¤ì • í•¨ìˆ˜ë“¤
        function showFirebaseSettings() {
            const modal = document.getElementById('firebaseModal');
            modal.style.display = 'flex';

            const apiKey = localStorage.getItem('firebase_apiKey');
            const projectId = localStorage.getItem('firebase_projectId');
            const savedSettingsInfo = document.getElementById('savedSettingsInfo');

            if (apiKey && projectId) {
                document.getElementById('firebaseApiKey').value = apiKey;
                document.getElementById('firebaseProjectId').value = projectId;
                savedSettingsInfo.style.display = 'block';
            } else {
                savedSettingsInfo.style.display = 'none';
            }
        }

        function saveFirebaseSettings() {
            const apiKey = document.getElementById('firebaseApiKey').value.trim();
            const projectId = document.getElementById('firebaseProjectId').value.trim();

            if (!apiKey || !projectId) {
                alert('API Keyì™€ Project IDë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            localStorage.setItem('firebase_apiKey', apiKey);
            localStorage.setItem('firebase_projectId', projectId);

            document.getElementById('firebaseModal').style.display = 'none';
            alert('Firebase ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
            location.reload();
        }

        function closeFirebaseModal() {
            document.getElementById('firebaseModal').style.display = 'none';
        }

        // ì„ íƒëœ êµì‚¬ ì¼ê´„ ì‚­ì œ
        function deleteSelectedTeachers() {
            if (!adminDashboard) return;

            const checkboxes = document.querySelectorAll('.delete-checkbox:checked');
            if (checkboxes.length === 0) {
                alert('ì‚­ì œí•  êµì‚¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const teacherKeys = Array.from(checkboxes).map(cb => cb.getAttribute('data-teacher-key'));
            const teacherNames = teacherKeys.map(key => adminDashboard.allSettings[key]?.name).filter(Boolean);

            if (!confirm('ë‹¤ìŒ êµì‚¬ë“¤ì˜ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n' + teacherNames.join(', ') + '\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }

            if (!adminDashboard.firebaseEnabled || !adminDashboard.database) {
                alert('Firebaseì— ì—°ê²°ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.\nì‚­ì œí•˜ë ¤ë©´ Firebase ì„¤ì •ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                return;
            }

            // Firebaseì—ì„œ ì¼ê´„ ì‚­ì œ
            const deletePromises = teacherKeys.map(key =>
                adminDashboard.database.ref('vacation-duty/' + key).remove()
            );

            Promise.all(deletePromises)
                .then(() => {
                    console.log('ì¼ê´„ ì‚­ì œ ì™„ë£Œ:', teacherKeys.length + 'ëª…');
                    alert(teacherKeys.length + 'ëª…ì˜ êµì‚¬ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                })
                .catch((error) => {
                    console.error('ì‚­ì œ ì‹¤íŒ¨:', error);
                    alert('ë°ì´í„° ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\n' + error.message);
                });
        }
    </script>
</body>
</html>
